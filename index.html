<html>
<head>
<title>Arche</title>
<script src="jquery-3.3.1.slim.min.js" type="text/javascript"></script>
<script>
    var foe;
    var arc;

    function loadJSON(callback) {
        var xobj = new XMLHttpRequest();
        xobj.overrideMimeType('application/json');
        xobj.open('GET', 'foe.json', true);
        xobj.onreadystatechange = function () {
            if (xobj.readyState == 4 && xobj.status == "200") {
                callback(xobj.responseText);
            }
        };
        xobj.send(null);
    }

    loadJSON(function(response) {
        foe = JSON.parse(response);

        $.each(foe.buildings.great, function(i, v) {
            if (v.name.en == 'Arc') {
                arc = v
            }
        });

        var select = document.getElementById('level');
        $.each(arc.levels, function(i, v) {
            var option = document.createElement('option');
            option.text = v.level;
            select.add(option);
        });

        document.getElementById('level').focus();
    });

    function displayLevel() {
        var select = document.getElementById('level');
        var level = select.options[select.selectedIndex].value;
        var bonus = document.getElementById('bonus').value;

        $.each(arc.levels, function (i, v) {
            if (v.level == level) {
                document.getElementById('research_points').innerText = v.research_points;
            }
        });

        $.each(arc.rewards, function (i, v) {
            if (v.level == level) {
                $.each(v.positions, function(i, v) {
                    document.getElementById('p' + v.position + '_rp').innerText = v.research_points;
                    document.getElementById('p' + v.position + '_rp2').innerText = v.research_points * parseFloat(bonus);
                });
            }
        });

        document.getElementById('rp_rest').innerText =
            parseInt(document.getElementById('research_points').innerText) -
            parseInt(document.getElementById('p1_rp').innerText) -
            parseInt(document.getElementById('p2_rp').innerText) -
            parseInt(document.getElementById('p3_rp').innerText) -
            parseInt(document.getElementById('p4_rp').innerText) -
            parseInt(document.getElementById('p5_rp').innerText);
        document.getElementById('rp2_rest').innerText =
            parseInt(document.getElementById('research_points').innerText) -
            parseInt(document.getElementById('p1_rp2').innerText) -
            parseInt(document.getElementById('p2_rp2').innerText) -
            parseInt(document.getElementById('p3_rp2').innerText) -
            parseInt(document.getElementById('p4_rp2').innerText) -
            parseInt(document.getElementById('p5_rp2').innerText);
        document.getElementById('rp2_advantage').innerText =
            parseInt(document.getElementById('rp_rest').innerText) -
            parseInt(document.getElementById('rp2_rest').innerText);

        document.getElementById('p12_rp2_safe').innerText =
            parseInt(document.getElementById('research_points').innerText) -
            parseInt(document.getElementById('p1_rp2').innerText) -
            2 * parseInt(document.getElementById('p2_rp2').innerText) + 1;
        document.getElementById('p123_rp2_safe').innerText =
            parseInt(document.getElementById('research_points').innerText) -
            parseInt(document.getElementById('p1_rp2').innerText) -
            parseInt(document.getElementById('p2_rp2').innerText) -
            2 * parseInt(document.getElementById('p3_rp2').innerText) + 1;
        document.getElementById('p1234_rp2_safe').innerText =
            parseInt(document.getElementById('research_points').innerText) -
            parseInt(document.getElementById('p1_rp2').innerText) -
            parseInt(document.getElementById('p2_rp2').innerText) -
            parseInt(document.getElementById('p3_rp2').innerText) -
            2 * parseInt(document.getElementById('p4_rp2').innerText) + 1;
        document.getElementById('p12345_rp2_safe').innerText =
            parseInt(document.getElementById('research_points').innerText) -
            parseInt(document.getElementById('p1_rp2').innerText) -
            parseInt(document.getElementById('p2_rp2').innerText) -
            parseInt(document.getElementById('p3_rp2').innerText) -
            parseInt(document.getElementById('p4_rp2').innerText) -
            2 * parseInt(document.getElementById('p5_rp2').innerText) + 1;
    }
</script>
</head>
<body>
<h1>Arche</h1>

<p>Support-Multiplikator: <input type="text" value="1.8" id="bonus" onchange="displayLevel();"></input></p>

<p>Level: <select size="1" id="level" onchange="displayLevel();"><option></option></select> FP=<span id="research_points"></span></p>

<table>
    <thead>
        <th></th>
        <th>P1</th>
        <th>P2</th>
        <th>P3</th>
        <th>P4</th>
        <th>P5</th>
        <th>Rest</th>
        <th>Advantage</th>
    </thead>
    <tr>
        <th>FP</th>
        <th><span id="p1_rp"></span></th>
        <th><span id="p2_rp"></span></th>
        <th><span id="p3_rp"></span></th>
        <th><span id="p4_rp"></span></th>
        <th><span id="p5_rp"></span></th>
        <th><span id="rp_rest"></span></th>
    </tr>
    <tr>
        <th>FP2</th>
        <th><span id="p1_rp2"></span></th>
        <th><span id="p2_rp2"></span></th>
        <th><span id="p3_rp2"></span></th>
        <th><span id="p4_rp2"></span></th>
        <th><span id="p5_rp2"></span></th>
        <th><span id="rp2_rest"></span></th>
        <th><span id="rp2_advantage"></span></th>
    </tr>
    <tr>
        <th>Safe</th>
        <th colspan="2"><span id="p12_rp2_safe">?</span></th>
    </tr>
    <tr>
        <th>Safe</th>
        <th colspan="3"><span id="p123_rp2_safe">?</span></th>
    </tr>
    <tr>
        <th>Safe</th>
        <th colspan="4"><span id="p1234_rp2_safe">?</span></th>
    </tr>
    <tr>
        <th>Safe</th>
        <th colspan="5"><span id="p12345_rp2_safe">?</span></th>
    </tr>
</table>

</body>
</html>